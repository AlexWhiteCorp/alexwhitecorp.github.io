<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WatchDog</title>
    <link rel="icon" href="favicon.png">

    <link rel="stylesheet" href="styles/common.css">
    <link rel="stylesheet" href="styles/header.css">
    <link rel="stylesheet" href="styles/nav.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.8.0/chart.min.js"></script>
</head>
<body>
<div class="header-wrapper">
    <div class="in-header">
        <img class="header-icon" src="favicon.png" alt="Logo">
        <div class="header-title">WatchDog</div>
    </div>
</div>
<div class="main-wrapper">
    <div class="in-main">
        <div class="nav-wrapper">
            <div class="nav-item"><a href="#about" class="nav-item-link">- About</a></div>
            <div class="nav-item"><a href="#install" class="nav-item-link">- Install</a></div>
            <div class="nav-sub-item"><a href="#install-macos" class="nav-item-link">- MacOS</a></div>
            <div class="nav-sub-item"><a href="#install-windows" class="nav-item-link">- Windows 10</a></div>
            <div class="nav-sub-item"><a href="#install-custom-build" class="nav-item-link">- Custom build</a></div>
            <div class="nav-item"><a href="#access-token" class="nav-item-link">- Generate Access Token</a></div>
        </div>
        <div class="content-wrapper">
            <a name="about"></a>
            <div class="block">
                <div class="block-title">About</div>
            </div>

            <a name="install"></a>
            <div class="block">
                <div class="block-title">Install</div>
            </div>

            <a name="install-macos"></a>
            <div class="block">
                <div class="block-title">Install on MacOS</div>
                <div class="in-block flex-block">
                    <div>After you have downloaded and launched installer for your arch
                        (<a class="download-mac-arm" href="">MacOS ARM</a> or <a class="download-mac64" href="">MacOS
                            x64</a>)
                        move <b>WatchDog</b> app to <b>Applications</b> folder.
                    </div>
                    <img class="default-img" style="max-width: 400px"
                         src="images/install-macos-1.png" alt="NotFound">
                </div>
                <div class="in-block flex-block">
                    <div>If you try to run WatchDog app you will receive error message that image is damaged.
                        It actually means that author haven't bought Apple Developer Id yet and haven't sign this app.
                        So application is moved to quarantine.
                    </div>
                    <img class="default-img" style="max-width: 300px"
                         src="images/install-macos-2.png" alt="NotFound">
                </div>
                <div class="in-block flex-block">
                    <div>To solve this problem you just need to run next command in terminal:</div>
                    <i class="code-block">
                        xattr -d com.apple.quarantine /Applications/WatchDog.app
                    </i>
                </div>
                <div class="in-block flex-block">
                    <div>
                        If you try to run app now from <b>Applications</b> tab <s>it will successful opens</s>
                        you will see new security alert <i>"... app is from an unidentified developer..</i>." :)
                    </div>
                </div>
                <div class="in-block flex-block">
                    <div>To solve this problem:</div>
                    <div class="in-block">1. Open System Preferences</div>
                    <div class="in-block">2. Go to Security & Privacy and select the General tab</div>
                    <div class="in-block">3. If you’ve been blocked from opening an app within the past hour,
                        this page will give you the option to override this by clicking the
                        temporary button ‘Open Anyway’..
                    </div>
                    <div class="in-block">4. You’ll be asked one more time if you’re sure, but clicking <b>Open</b> will
                        run the app
                    </div>
                    <img class="default-img" style="max-width: 500px"
                         src="images/install-macos-3.png" alt="NotFound">
                </div>
                <div class="in-block flex-block">
                    Happy end!
                </div>
                <div class="in-block flex-block">
                    <div>
                        Or you can try to go to <a href="#install-custom-build">Custom build</a> guide(<b>npm</b> and
                        <b>Node.js</b> are required).
                        If you generate app build on your machine you will avoid any security error message.
                    </div>
                </div>
            </div>

            <a name="install-windows"></a>
            <div class="block">
                <div class="block-title">Install on Windows 10</div>
                <div class="in-block flex-block">
                    <div>After you have downloaded and launched installer
                        (<a class="download-win64" href="">Windows x64</a>)
                        you will receive warning message:
                    </div>
                    <img class="default-img" style="max-width: 500px"
                         src="images/install-windows-1.png" alt="NotFound">
                </div>
                <div class="in-block">
                    It actually means that author haven't bought certificate yet and haven't sign this app.
                </div>
                <div class="in-block flex-block">
                    <div>Click <b>More info</b> and your will see <b>Run anyway</b> button.</div>
                    <img class="default-img" style="max-width: 450px"
                         src="images/install-windows-2.png" alt="NotFound">
                </div>
                <div class="in-block">
                    That's all :)
                </div>
            </div>

            <a name="install-custom-build"></a>
            <div class="block">
                <div class="block-title">Install using Custom Build</div>
                <div class="in-block">
                    You can try to generate custom build using project source code.
                    In this way you will avoid any security warning related to the lack of signature.
                    For this you need <b>npm</b> and <b>Node.js</b> installed.
                </div>
                <div class="in-block flex-block">
                    <div>Clone source code from project official repository:</div>
                    <i class="code-block">
                        git clone https://github.com/AlexWhiteCorp/watchdog.git
                    </i>
                </div>
                <div class="in-block flex-block">
                    <div>Move inside cloned directory and install needed dependencies</div>
                    <i class="code-block">
                        npm install
                    </i>
                </div>
                <div class="in-block flex-block">
                    <div>And finally generate you personal build:</div>
                    <i class="code-block">
                        npm run electron:build
                    </i>
                </div>
                <div class="in-block">
                    Electron-builder will automatically detect your OS and arch type and create install launcher.
                    You can find it in <b><i>dist_electron</i></b> folder. Final name depends on you OS, arch and app version:
                </div>
                <div class="in-block"><b>MacOS ARM: </b><i>dist_electron/WatchDog-{version}-arm64.dmg</i></div>
                <div class="in-block"><b>MacOS x64: </b><i>dist_electron/WatchDog-{version}.dmg</i></div>
                <div class="in-block"><b>Windows x64: </b><i>dist_electron/WatchDog Setup {version}.exe</i></div>
            </div>

            <a name="access-token"></a>
            <div class="block">
                <div class="block-title">How to generate GitHub Access Token</div>
                <div class="in-block">
                    Use this step-by-step
                    <a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token"
                       target="_blank">GitHub Official Instruction</a>
                    to generate access token. <br>
                </div>
                <div class="in-block flex-block">
                    <div>Token should has next access scopes for correct work:</div>
                    <b class="in-block">- repo (all)</b>
                    <img class="default-img" style="max-width: 250px"
                         src="images/generate-token-1.png" alt="NotFound">
                    <b class="in-block">- admin:org (only read:org)</b>
                    <img class="default-img" style="max-width: 250px"
                         src="images/generate-token-2.png" alt="NotFound">
                </div>
                <div class="in-block flex-block">
                    <div>Don't forget to <b>Authorize SSO</b> (Single Sign-On) if it's enabled by your organization
                        (it's important!).
                    </div>
                    <img class="default-img" style="max-width: 400px"
                         src="images/generate-token-3.png" alt="NotFound">
                </div>
            </div>

            <a name="usage"></a>
            <div id="usage-statistic" class="block">
                <div class="block-title">Usage Statistic</div>
                <canvas id="chart-canvas"></canvas>
                <script>
                    if (document.location.hash !== '#usage') {
                        document.getElementById('usage-statistic').style.display = 'none'
                    }

                    const GIT_HUB_PATH = 'https://api.github.com'

                    function loadChart(data) {
                        const config = {
                            type: 'bar',
                            data: data,
                            options: {
                                plugins: {
                                    legend: {
                                        labels: {
                                            color: '#adbac7'
                                        }
                                    }
                                },
                                scales: {
                                    x: {
                                        ticks: {color: '#adbac7'}
                                    },
                                    y: {
                                        ticks: {color: '#adbac7', precision: 0}
                                    }
                                }
                            }
                        };

                        const chart = new Chart(
                            document.getElementById('chart-canvas'),
                            config
                        );
                    }

                    function serveChartData(labels, datasets) {
                        const common = {
                            maxBarThickness: 35,
                            categoryPercentage: 0.2,
                            barPercentage: 1.0
                        }

                        return {
                            labels: labels,
                            datasets: [
                                {
                                    label: 'Mac ARM',
                                    backgroundColor: '#ffb55a',
                                    borderColor: '#ffb55a',
                                    data: datasets[0],
                                    ...common
                                },
                                {
                                    label: 'Mac x64',
                                    backgroundColor: '#00bfa0',
                                    borderColor: '#00bfa0',
                                    data: datasets[1],
                                    ...common
                                },
                                {
                                    label: 'Windows x64',
                                    backgroundColor: '#0d88e6',
                                    borderColor: '#0d88e6',
                                    data: datasets[2],
                                    ...common
                                }
                            ]
                        };
                    }

                    axios.get(GIT_HUB_PATH + '/repos/AlexWhiteCorp/watchdog/releases')
                        .then(response => {
                            const labels = []
                            const datasets = [[], [], []]

                            response.data.forEach(release => {
                                const macArmAsset = release.assets.find(asset => asset.name.indexOf('arm64.dmg') !== -1)
                                const mac64Asset = release.assets.find(asset => asset.name.indexOf('.dmg') !== -1 && asset.name.indexOf('arm64.dmg') === -1)
                                const win64Asset = release.assets.find(asset => asset.name.indexOf('.exe') !== -1)

                                labels.push(release.tag_name)
                                datasets[0].push(macArmAsset.download_count)
                                datasets[1].push(mac64Asset.download_count)
                                datasets[2].push(win64Asset.download_count)
                            })

                            const data = serveChartData(labels, datasets)

                            loadChart(data)
                        })
                </script>
            </div>

            <script>
                axios.get('versions.json')
                    .then(response => {
                        const versions = response.data
                        let elements = document.getElementsByClassName('download-mac-arm')
                        for (const el of elements) {
                            el.href = versions['mac-arm'].download_url
                        }

                        elements = document.getElementsByClassName('download-mac64')
                        for (const el of elements) {
                            el.href = versions['mac64'].download_url
                        }

                        elements = document.getElementsByClassName('download-win64')
                        for (const el of elements) {
                            el.href = versions['win64'].download_url
                        }
                    })
            </script>
        </div>
    </div>
</div>
</body>
</html>